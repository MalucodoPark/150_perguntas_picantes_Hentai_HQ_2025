<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz ‚Äì +18 com Pr√©‚ÄëDados e WhatsApp</title>
 <style>
  :root{
    --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb;
    --accent:#22c55e; --accent-2:#3b82f6; --danger:#ef4444; --ring:#1f2937;
    --bg-img: url('home.jpg'); /* imagem inicial; o JS troca depois */
  }

  *{box-sizing:border-box}

  /* √öNICA regra de background */
  body{
    margin:0;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Noto Sans,Arial;
    color:var(--text);
    min-height:100dvh; display:grid; place-items:center; padding:25px;
    background:
      linear-gradient(180deg, rgba(2,6,23,.72), rgba(2,6,23,.88)),
      var(--bg-img) center / cover no-repeat,
      radial-gradient(1200px 800px at 20% -10%, #1e293b, transparent),
      radial-gradient(900px 700px at 120% 10%, #0b1324, transparent),
      var(--bg);
  }

  .container{width:min(900px,100%)}
  .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
        border:1px solid var(--ring); box-shadow:0 10px 30px rgba(0,0,0,.35);
        border-radius:20px; padding:24px; backdrop-filter:saturate(130%) blur(6px);}
  .header{display:flex; gap:16px; align-items:center; justify-content:space-between; margin-bottom:8px}
  .title{font-size:clamp(20px,3.4vw,30px); font-weight:700; color:var(--text)}
  .subtitle{color:var(--muted); font-size:19px}
  .progress-wrap{margin:14px 0 22px}
  .progress-bar{height:10px; background:#0b1220; border-radius:999px; overflow:hidden; border:1px solid var(--ring)}
  .progress-bar>div{height:100%; background:linear-gradient(90deg, var(--accent-2), var(--accent)); width:0%; transition:width .25s ease}
  .question{font-size:clamp(18px,3vw,22px); font-weight:600; margin:12px 0 18px; color:var(--text)}
  .options{display:grid; grid-template-columns:1fr; gap:10px; margin-bottom:16px}
  @media(min-width:640px){.options{grid-template-columns:repeat(3,1fr)}}
  .btn{appearance:none; border:none; cursor:pointer; padding:14px 16px; border-radius:14px;
       background:#0b1220; color:var(--text); border:1px solid var(--ring); font-weight:600;
       letter-spacing:.2px; transition: transform .04s ease, border-color .2s ease, box-shadow .2s ease, background .2s ease;}
  .btn:hover{transform:translateY(-1px); border-color:#374151}
  .btn:active{transform:translateY(0)}
  .btn[disabled]{opacity:.55; cursor:not-allowed}
  .option{display:flex; align-items:center; justify-content:center; text-align:center; min-height:64px}
  .option.selected{outline:2px solid transparent; border-color:transparent;
       background:linear-gradient(180deg, rgba(34,197,94,.12), rgba(59,130,246,.12)), #0b1220;
       box-shadow:0 0 0 2px #1e3a8a inset, 0 0 0 1px #14532d inset}
  .nav{display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:8px}
  .left-actions,.right-actions{display:flex; gap:10px; align-items:center}
  .pill{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--ring); background:#0b1220; color:var(--muted)}
  .result{display:none}
  .result.show{display:block}
  .answers{margin:12px 0; padding:0; list-style:none; display:grid; gap:8px}
  .answers li{background:#0b1220; border:1px solid var(--ring); border-radius:12px; padding:12px}

  /* Form */
  .form{display:grid; gap:12px; grid-template-columns:1fr}
  @media(min-width:640px){.form{grid-template-columns:repeat(2,1fr)}}
  .field{display:flex; flex-direction:column; gap:6px}
  .field label{font-size:13px; color:var(--muted)}
  .input{appearance:none; background:#0b1220; color:var(--text); border:1px solid var(--ring); border-radius:10px; padding:12px}
  .row-span-2{grid-column:1 / -1}
  .error{color:var(--danger); font-size:12px; display:none}

  /* Chips */
  .chip-group{display:flex; flex-wrap:wrap; gap:8px}
  .chip{padding:10px 14px; border-radius:999px; background:#0b1220; border:1px solid var(--ring); cursor:pointer; font-weight:600; color:var(--text)}
  .chip[aria-pressed="true"]{background:linear-gradient(180deg, rgba(34,197,94,.12), rgba(59,130,246,.12)); box-shadow:0 0 0 2px #1e3a8a inset, 0 0 0 1px #14532d inset}
</style>

</head>
<body>
  <div class="container">
    <div class="card" role="group" aria-label="Quiz">
      <div class="header">
        <div>
          <div class="title">Seu Quiz</div>
          <div id="quizDesc" class="subtitle">Personalize na se√ß√£o <code>CONFIGURA√á√ÉO</code>.</div>
        </div>
        <div class="pill" id="stepLabel">+18</div>
      </div>

      <div class="progress-wrap" aria-hidden="true">
        <div class="progress-bar" aria-label="Progresso do quiz" aria-live="polite"><div id="progress"></div></div>
      </div>

      <!-- TELA +18 -->
      <div id="screen-agegate">
        <div class="question" aria-live="polite" style="text-align:center;font-size:clamp(28px,6vw,48px);">+18</div>
        <p class="subtitle" style="text-align:center;margin-top:-4px">Conte√∫do destinado a maiores de 18 anos</p>
        <div class="nav">
          <div class="left-actions">
            <button id="btnAgeExit" class="btn" type="button">Sair</button>
          </div>
          <div class="right-actions">
            <button id="btnAgeContinue" class="btn" type="button">Avan√ßar ‚ü∂</button>
          </div>
        </div>
      </div>

      <!-- Tela de pr√©-dados -->
      <div id="screen-intro" style="display:none">
        <div class="question">Antes de come√ßar, preencha seus dados</div>
        <div class="form" aria-label="Dados iniciais">
          <div class="field">
            <label>G√™nero</label>
            <div id="generoChips" class="chip-group" role="radiogroup" aria-label="Selecionar g√™nero"></div>
            <div id="errGenero" class="error">Selecione uma op√ß√£o.</div>
          </div>
          <div class="field">
            <label for="idadeInput">Idade</label>
            <input id="idadeInput" class="input" type="number" min="0" inputmode="numeric" placeholder="Ex: 28" />
            <div id="errIdade" class="error">Informe uma idade v√°lida (18+).</div>
          </div>
          <div class="field">
            <label for="alturaInput">Altura (cm)</label>
            <input id="alturaInput" class="input" type="number" min="0" inputmode="numeric" placeholder="Ex: 172" />
            <div id="errAltura" class="error">Informe a altura em cent√≠metros.</div>
          </div>
          <div class="field">
            <label for="pesoInput">Peso (kg)</label>
            <input id="pesoInput" class="input" type="number" min="0" inputmode="numeric" placeholder="Ex: 70" />
            <div id="errPeso" class="error">Informe um peso v√°lido.</div>
          </div>
          <div class="field row-span-2">
            <label>Orienta√ß√£o</label>
            <div id="orientacaoChips" class="chip-group" role="radiogroup" aria-label="Selecionar orienta√ß√£o"></div>
            <input id="orientacaoOutro" class="input" type="text" placeholder="Digite sua orienta√ß√£o" style="display:none;margin-top:6px" />
            <div id="errOrientacao" class="error">Selecione uma op√ß√£o ou informe sua orienta√ß√£o.</div>
          </div>
        </div>
        <div class="nav">
          <div class="left-actions">
            <button id="btnIntroBack" class="btn" type="button">‚üµ Voltar</button>
          </div>
          <div class="right-actions">
            <button id="btnStart" class="btn" type="button">Avan√ßar ‚ü∂</button>
          </div>
        </div>
      </div>

      <!-- Tela do quiz -->
      <div id="screen-quiz" style="display:none">
        <div id="question" class="question">Carregando‚Ä¶</div>
        <div id="options" class="options" role="listbox" aria-label="Op√ß√µes"></div>
        <div class="nav">
          <div class="left-actions">
            <button id="btnBack" class="btn" type="button">‚üµ Voltar</button>
          </div>
          <div class="right-actions">
            <button id="btnNext" class="btn" type="button" disabled>Avan√ßar ‚ü∂</button>
          </div>
        </div>
      </div>

      <!-- Tela de resultado -->
      <div id="screen-result" class="result" aria-live="polite">
        <h2>Resultado</h2>
        <p id="finalMessage">Mensagem final aqui.</p>
        <h3>Seus dados</h3>
        <ul class="answers" id="userData"></ul>
        <h3>Suas escolhas</h3>
        <ol id="answers" class="answers"></ol>
        <div class="nav">
          <div class="left-actions">
            <button id="btnReiniciar" class="btn" type="button">Come√ßar de Novo!</button>
          </div>
          <div class="right-actions">
            <button id="btnWhatsApp" class="btn" type="button">Concluir</button>
          </div>
        </div>
        <p class="footer-note">Ao concluir, as respostas ser√£o registradas na planilha e o WhatsApp ser√° aberto.</p>
      </div>
    </div>
  </div>

  <script>
  // =======================
  // üîß CONFIGURA√á√ÉO
  // =======================
  const quizConfig = {
    percentLabels: ["Safado(a)", "Santo(a)", "Indiferente(a)"],
    titulo: "Seu Quiz +18",
  descricao: "Conte√∫do adulto (+18). Este quiz tem finalidade recreativa; as porcentagens s√£o aproximadas e n√£o possuem valor cient√≠fico.",
  finalMessage: "\n".repeat(20) + "Obrigado por responder! Esta √© a mensagem final que voc√™ definiu." + "\n".repeat(20),
  whatsappNumber: "5585997469454", // s√≥ d√≠gitos (com DDI)
  firstMessage: "Oi! Quero participar do quiz. Pode me atender?",
    sheetWebAppURL: "https://script.google.com/macros/s/AKfycbxJ2j4PJyHmUWC4rcefgCjEVMvAhpEvMo3VOoLsYcHOJQ2L7bS_CLDE70E1Gixr5KQ/exec",
    generos: ["Homem","Mulher"],
    orientacoes: ["Heterossexual","Homossexual","Bissexual","Assexual","Pansexual","Prefiro n√£o dizer","Outro"],
    perguntas: [
       { texto: "No primeiro encontro, voc√™ prefere beber o qu√™?", opcoes: ["Topo qualquer drink üçπ", "S√≥ socialmente", "N√£o bebo"] },
            { texto: "Bebida favorita para relaxar?", opcoes: ["Drinks/cerveja/vinho", "Suco/refrigerante", "√Ågua/sem bebida"] },
            { texto: "Voc√™ tem/curte animais de estima√ß√£o?", opcoes: ["Amo (tenho ou teria) üê∂", "Gosto, mas n√£o tenho", "Prefiro n√£o"] },
            { texto: "Fim de semana ideal?", opcoes: ["Sair (bar/festa/parque)", "Filme/jantar em casa", "Ficar off total"] },
            { texto: "Praia ou serra?", opcoes: ["Praia ‚òÄÔ∏è", "Tanto faz", "Serra üèîÔ∏è"] },
            { texto: "Voc√™ curte dan√ßar?", opcoes: ["Sim, me jogo na pista", "√Äs vezes", "Quase nunca"] },
            { texto: "Topa viagem surpresa?", opcoes: ["Sim, adoro", "Talvez, avisando antes", "Prefiro planejar tudo"] },
            { texto: "M√∫sica para o clima?", opcoes: ["Fa√ßo playlist üî•", "Depende do humor", "Prefiro sil√™ncio"] },
            { texto: "Aplicativos de encontro:", opcoes: ["Uso sem tabu", "De vez em quando", "N√£o uso"] },
            { texto: "Ir a um bar/evento LGBT+ com o par:", opcoes: ["Topo e curto", "Talvez, para conhecer", "N√£o me sinto √† vontade"] },
            { texto: "Beijo em p√∫blico:", opcoes: ["Sem medo de carinho", "Discreto, quase nada", "Tanto faz"] },
            { texto: "Beijo em p√∫blico (leve) te incomoda?", opcoes: ["Tranquilo, curto", "Depende do lugar", "Prefiro evitar"] },
            { texto: "Beijo em p√∫blico te incomoda?", opcoes: ["Gosto e n√£o ligo", "Prefiro evitar", "Depende do lugar"] },
            { texto: "Carinho em p√∫blico (m√£o dada/abra√ßo):", opcoes: ["Curto bastante", "Quase n√£o fa√ßo", "Depende do lugar"] },
            { texto: "Voc√™ guarda segredos com facilidade", opcoes: ["Sim", "N√£o", "Prefiro n√£o dizer"] },
            { texto: "Trairia Alguma vez?", opcoes: ["Sim", "N√£o", "Talvez"] },
            { texto: "Ritual p√≥s-encontro:", opcoes: ["Segunda rodada üòè", "Abra√ßo e dormir", "Tanto faz"] },
            { texto: "Surpresas no dia/hor√°rio:", opcoes: ["Amo surpresa", "Gosto de planejar", "Tanto faz"] },
            { texto: "M√∫sica no momento:", opcoes: ["Playlist quente", "Sil√™ncio/ambiente", "Indiferente"] },
            { texto: "Cheiros e perfumes:", opcoes: ["Amo perfume marcante", "Quase sem cheiro", "Indiferente"] },
            { texto: "Cheiros/perfume marcante:", opcoes: ["Amo perfume forte", "Quase sem cheiro", "Indiferente"] },

            { texto: "Beijos: como prefere?", opcoes: ["Intensos e demorados", "Leves e calmos", "Tanto faz"] },
            { texto: "Beijo com mordidinha leve:", opcoes: ["Adoro", "√Äs vezes", "Prefiro n√£o"] },
            { texto: "Cartas bilhetes er√≥ticos escritos √† m√£o:", opcoes: ["Amo a ideia", "Talvez, de vez em quando", "N√£o curto"] },
            { texto: "Roupa preferida nele(a):", opcoes: ["Lingerie / cueca estilosa", "Pijama/roupa b√°sica", "Sem prefer√™ncia"] },
            { texto: "Iniciativa:", opcoes: ["Eu tomo a iniciativa", "Prefiro ser convidado(a)", "Tanto faz"] },
            { texto: "Tomar a iniciativa por mensagem:", opcoes: ["Fa√ßo sempre", "Quase nunca", "√Äs vezes"] },
            { texto: "Tom do momento:", opcoes: ["Quente e acelerado", "Lento e rom√¢ntico", "Conforme a vibe"] },
            { texto: "Tom do encontro:", opcoes: ["Quente e intenso", "Calmo e carinhoso", "Vai do momento"] },
            { texto: "Banho a dois:", opcoes: ["Super topo", "Prefiro sozinho(a)", "Tanto faz"] },
            { texto: "Chuveiro a dois:", opcoes: ["Sempre topo", "Prefiro sozinho(a)", "Indiferente"] },
            { texto: "Fotos sensuais:", opcoes: ["Curto mandar/receber", "N√£o mando/evito", "Talvez em raros momentos"] },
            { texto: "Fotos sensuais entre o casal:", opcoes: ["Mando/recebo", "Evito total", "Raramente"] },
            { texto: "Te agrada ouvir elogios mais ousados?", opcoes: ["Adoro", "Prefiro discretos", "Depende de quem/como"] },
            { texto: "Sexo matinal te agrada?", opcoes: ["Amo come√ßar o dia assim", "Prefiro √† noite", "Tanto faz"] },
            { texto: "Frequ√™ncia ideal:", opcoes: ["Sempre que der", "S√≥ quando pinta clima", "Sem regra"] },
            { texto: "Assistir algo juntos para esquentar:", opcoes: ["Curto bastante", "Prefiro conversar", "Depende do humor"] },
            { texto: "Filminho adulto juntos:", opcoes: ["Topo assistir", "Prefiro n√£o", "Talvez"] },
            { texto: "Assistir/ler conte√∫do er√≥tico juntos (soft):", opcoes: ["Curto sim", "Talvez, depende do dia", "N√£o curto"] },
            { texto: "M√∫sica no quarto:", opcoes: ["Fa√ßo playlist quente", "Prefiro sil√™ncio", "Indiferente"] },

            { texto: "Preliminares‚Ä¶", opcoes: ["Longas e criativas", "Curtinhas, sem exagero", "Indiferente"] },
            { texto: "Qual √© sua forma favorita de preliminares?", opcoes: ["Toque", "Olhar", "Outra"] },
            { texto: "Luz no quarto:", opcoes: ["Acesa, adoro ver tudo", "Apagada, mais discreto", "Tanto faz"] },
            { texto: "Mensagens picantes:", opcoes: ["Curto e mando tamb√©m", "Prefiro evitar", "Depende do clima"] },
            { texto: "Curte mandar √°udios picantes?", opcoes: ["Sim, adoro", "Prefiro n√£o", "Depende do momento"] },
            { texto: "Sussurrar no ouvido (dirty talk leve):", opcoes: ["Amo/super curto", "Depende do clima", "Prefiro sil√™ncio"] },
            { texto: "Apelidos/elogios mais ousados:", opcoes: ["Gosto bastante", "Depende do momento", "Prefiro evitar"] },
            { texto: "Provocar em p√∫blico de forma discreta:", opcoes: ["Acho excitante", "Talvez, bem discreto", "N√£o curto"] },
            { texto: "Topa um strip poker ou jogo de desafios leve?", opcoes: ["Sim, bora brincar", "Talvez, se for leve", "Prefiro n√£o"] },
            { texto: "Jogo de ‚ÄúVerdade ou Desafio‚Äù (vers√£o leve/ousada):", opcoes: ["Topo", "Talvez, com limites", "Prefiro n√£o"] },
            { texto: "Topa usar venda nos olhos?", opcoes: ["Sim, curto a ideia", "N√£o faz meu estilo", "Talvez"] },
            { texto: "Massagem antes do clima:", opcoes: ["Sempre pe√ßo", "Quase nunca", "Depende do dia"] },
            { texto: "Massagem nos p√©s (dar/receber):", opcoes: ["Amo/curioso(a)", "√Äs vezes", "N√£o faz meu estilo"] },
            { texto: "Brincadeiras com gelo/temperatura:", opcoes: ["Amo sensa√ß√µes", "N√£o curto", "Talvez"] },
            { texto: "Explorar √≥leo corporal:", opcoes: ["Gosto muito", "N√£o curto meleca", "Talvez"] },
            { texto: "Explorar roupa √≠ntima/lingerie juntos (experimentar):", opcoes: ["Curto muito", "Talvez, de vez em quando", "Prefiro n√£o"] },
            { texto: "Fantasia com figurino/tema:", opcoes: ["Amo brincar", "N√£o curto", "Talvez"] },
            { texto: "Fantasia a dois:", opcoes: ["Topa e gosta de inventar", "N√£o √© minha praia", "Talvez, se rolar"] },
            { texto: "Surpresas no quarto:", opcoes: ["Amo novidades", "Melhor sem surpresas", "Depende"] },
            { texto: "Brincadeira ousada leve:", opcoes: ["Curto experimentar", "Passo", "Talvez"] },
            { texto: "Lugar diferente (discreto) te atrai?", opcoes: ["Gosto de inovar", "Prefiro s√≥ no quarto", "Talvez, se seguro"] },
            { texto: "Explorar no mar/piscina (seguran√ßa e discri√ß√£o):", opcoes: ["Topo sim", "Talvez, melhor piscina", "Prefiro n√£o"] },
            { texto: "No carro (parado e discreto):", opcoes: ["Topo sim", "Talvez, dependendo do local", "Prefiro n√£o"] },
            { texto: "C√¢mera ligada (privado) entre o casal:", opcoes: ["Curto videochamada", "Prefiro n√£o", "Depende da confian√ßa"] },

            { texto: "Explorar brinquedos:", opcoes: ["Curioso(a) e aberto(a)", "Prefiro n√£o usar", "Indiferente"] },
            { texto: "Brinquedos a dois:", opcoes: ["Topo testar", "Prefiro sem", "Depende"] },
            { texto: "Vibrador controlado por app:", opcoes: ["Topo testar", "Talvez, em casa", "Prefiro n√£o"] },
            { texto: "Passeio em sex shop a dois:", opcoes: ["Bora explorar", "Talvez, ver de leve", "Prefiro n√£o"] },
            { texto: "Tapinhas/pegada mais firme:", opcoes: ["Gosto bastante", "Prefiro leve", "Conforme a vibe"] },
            { texto: "Algemas/fitas (leve e seguro):", opcoes: ["Gosto/tenho curiosidade", "Talvez, com limites", "Prefiro n√£o"] },
            { texto: "Combinar palavra de seguran√ßa (limites):", opcoes: ["Claro, importante", "Talvez, se precisar", "N√£o vejo necessidade"] },
            { texto: "Roleplay adulto (chefe/assistente):", opcoes: ["Curto a ideia", "Talvez, de vez em quando", "N√£o curto"] },
            { texto: "‚ÄúJogo do m√©dico‚Äù (adulto, consensual):", opcoes: ["Curioso(a)/topo", "Talvez, uma vez", "N√£o curto"] },
            { texto: "Provocar e segurar (edging):", opcoes: ["Gosto bastante", "Talvez, √†s vezes", "Prefiro n√£o"] },
            { texto: "Comandos de voz (dar/seguir) no momento:", opcoes: ["Curto conduzir/seguir", "Talvez alternando", "Prefiro sem"] },
            { texto: "Fazer/receber striptease:", opcoes: ["Amo a ideia", "Prefiro sem", "Talvez"] },
            { texto: "Ir a um clube de strip juntos:", opcoes: ["Iria sim", "Talvez, para conhecer", "N√£o iria"] },
            { texto: "Espelho na brincadeira (se ver/filtrar poses):", opcoes: ["Curto a ideia", "Tanto faz", "N√£o curto"] },
            { texto: "Ver o(a) parceiro(a) se tocar:", opcoes: ["Gosto/tenho curiosidade", "Talvez, √†s vezes", "Prefiro n√£o"] },
            { texto: "Beijaria algu√©m do mesmo sexo se rolasse clima?", opcoes: ["Sim, beijaria", "Talvez, curiosidade leve", "N√£o beijaria"] },
            { texto: "Carinho/experi√™ncia com pessoa do mesmo sexo (leve):", opcoes: ["Conversaria/toparia", "Talvez, curiosidade leve", "N√£o topo"] },
            { texto: "Trio consensual (MFM/MMF/FFM):", opcoes: ["Conversaria/toparia", "Talvez, com regras", "N√£o topo"] },
            { texto: "Iria a uma praia/col√¥nia de nudismo?", opcoes: ["Sim, tenho curiosidade", "Talvez, com discri√ß√£o", "N√£o iria"] },
            { texto: "Voc√™ se sente desconfort√°vel em ficar pelado na frente de desconhecidos?", opcoes: ["Ficaria", "Tenho muita vergonha.", "Prefiro outro tipo de fetiche"] },

            { texto: "Protagonismo:", opcoes: ["Gosto de liderar", "Prefiro que conduzam", "Tanto faz pra mim"] },
            { texto: "Protagonismo no momento:", opcoes: ["Gosto de conduzir", "Prefiro ser conduzido(a)", "Alterno"] },
            { texto: "Prefere ser?", opcoes: ["Prefiro dominar, sempre", "Amo ser submisso", "Outra"] },
            { texto: "Voc√™ se considera numa rela√ß√£o", opcoes: ["100% Ativo", "Versatil", "Passivo"] },
            { texto: "Voc√™ aceitaria algu√©m", opcoes: ["100% ativo(a)", "Passivo", "Outra"] },
            { texto: "J√° teve expereriencias BI?", opcoes: ["Sim", "N√£o", "Gostaria"] },
            { texto: "J√° Saiu com gay ou bi?", opcoes: ["Sim", "N√£o", "Gostaria"] },
            { texto: "J√° Saiu com trans ou sairia?", opcoes: ["Sim", "N√£o", "Gostaria"] },
            { texto: "J√° Saiu com casada?", opcoes: ["Sim", "N√£o", "Gostaria"] },
            { texto: "Qual parte do corpo te da mais prazer?", opcoes: ["Regiao Intima", "Barriga", "Pernas"] },
            { texto: "Posi√ß√£o favorita:", opcoes: ["A que deixa mais intenso", "A cl√°ssica e confort√°vel", "Qualquer uma"] },
            { texto: "Explorar novas posi√ß√µes:", opcoes: ["Curto testar", "Fico nas cl√°ssicas", "Talvez"] },
            { texto: "Prefere o que?", opcoes: ["Realizar", "Assitir", "Outra"] },
            { texto: "Falar safadezas:", opcoes: ["Gosto de falar/ouvir", "Prefiro sil√™ncio", "Depende da hora"] },
            { texto: "Tom de voz durante:", opcoes: ["Gosto de falar safadezas", "Quase n√£o falo", "Vai do clima"] },

            { texto: "Voc√™ se toca?", opcoes: ["Sim", "N√£o", "Outra"] },
            { texto: "Aceitaria Alguem toca?", opcoes: ["Sim", "N√£o", "Outra"] },
            { texto: "Se voc√™ pudesse escolher uma fantasia para realizar, qual seria?", opcoes: ["Anal", "Oral", "Prefiro outro tipo de fetiche"] },
            { texto: "J√° fez anal alguma vez na vida?", opcoes: ["Sim", "N√£o", "Gostaria"] },
            { texto: "J√° fizeram oral em voc√™ alguma vez na vida?", opcoes: ["Sim", "N√£o", "Gostaria"] },
            { texto: "Qual posicao mais te atrai?", opcoes: ["Quatro", "Joelhos", "Outra"] },
            { texto: "Ritmo preferido:", opcoes: ["Mais forte", "Mais leve", "Misturado"] },
            { texto: "J√° pensou em introduzir algo maior na hora do sexo?", opcoes: ["Tenho muita vergonha, melhor n√£o", "Estou pensando em come√ßar a usar", "Prefiro outro tipo de fetiche"] },

            { texto: "Gosta de assitir xvideos?", opcoes: ["Sim", "Nunca", "Gostaria"] },
            { texto: "J√° recebeu uma m√£o amiga?", opcoes: ["Sim", "Nunca", "Gostaria"] },
            { texto: "J√° gozou na boca de alguem?", opcoes: ["Sim", "Nunca", "Gostaria"] },
            { texto: "Qual fetiche em gozar?", opcoes: ["Na boca", "No cuzinho", "Ambos"] },
            { texto: "Voc√™ curte uma mijada na hora do sexo?", opcoes: ["Nem pensar", "Adoraria essa experi√™ncia", "Prefiro outro tipo de fetiche"] },
            { texto: "Qual tamanho do seu P√™nis?", opcoes: ["Maior que 15cm", "Maior que 20cm", "Menor que 10cm"] },
            { texto: "Qual espessura?", opcoes: ["Fino", "Grosso", "Normal"] }, 
            { texto: "√öltimo teste de IST?", opcoes: ["At√© 3 meses", "3‚Äì12 meses", "Mais de 1 ano/N√£o lembro"] },
            { texto: "Uso de PrEP/PEP:", opcoes: ["Uso PrEP", "N√£o uso", "Quero saber mais"] },
            { texto: "Prefer√™ncia por prote√ß√£o (preservativo/barreira):", opcoes: ["Sempre", "Conforme combinado e exames", "Conversamos antes"] },
            { texto: "Quem leva a prote√ß√£o?", opcoes: ["Eu levo", "Voc√™ leva", "Ambos"] },
            { texto: "Alergia a l√°tex ou lubrificante?", opcoes: ["Sim", "N√£o", "N√£o sei"] },
            { texto: "Tipo de lubrificante preferido:", opcoes: ["√Ä base de √°gua", "√Ä base de silicone", "Outro/indiferente"] },
            { texto: "Lubrificante com sabor/aroma:", opcoes: ["Gosto", "Prefiro neutro", "Evito"] },
            { texto: "Depila√ß√£o/pele (sua prefer√™ncia):", opcoes: ["Natural", "Aparado(a)", "Depilado(a)"] },
            { texto: "Barulho/sons durante:", opcoes: ["√Ä vontade", "Moderado", "Discreto"] },
            { texto: "Marcas no corpo (suc√ß√£o/arranh√µes):", opcoes: ["Ok", "S√≥ onde n√£o aparece", "Prefiro evitar"] },
            { texto: "Puxar cabelo:", opcoes: ["Gosto", "Bem de leve", "Prefiro n√£o"] },
            { texto: "Unhas/arranh√µes:", opcoes: ["Ok", "Leve", "Evito"] },
            { texto: "Beijo com mais saliva:", opcoes: ["Curto", "Moderado", "Prefiro seco"] },
            { texto: "Beijo/cheiro no pesco√ßo:", opcoes: ["Amo", "De leve", "Prefiro n√£o"] },
            { texto: "Perfume forte durante:", opcoes: ["Amo", "Suave", "Evito por alergia"] },
            { texto: "Privacidade de registros (foto/v√≠deo):", opcoes: ["Sem registros", "Fotos sem rosto", "Ok com regras claras"] },
            { texto: "Destino de registros (se houver):", opcoes: ["Apagar depois", "Guardar com permiss√£o", "N√£o tiro/recebo"] },
            { texto: "Check-ins de consentimento durante:", opcoes: ["Gosto que pergunte", "Sinais sutis bastam", "S√≥ aviso se algo incomodar"] },
            { texto: "Pausas para √°gua/respirar:", opcoes: ["Gosto de pausas", "S√≥ quando preciso", "Prefiro sem pausas"] },
            { texto: "Aftercare (depois):", opcoes: ["Abra√ßo/conversa", "√Ågua/descanso", "Prefiro ficar quieto(a)"] },
            { texto: "Limita√ß√µes f√≠sicas/les√µes a considerar:", opcoes: ["Tenho/explico antes", "Nenhuma relevante", "Prefiro falar na hora"] },
            { texto: "Temperatura/ambiente:", opcoes: ["Ar ligado", "Ambiente natural", "Tanto faz"] },
            { texto: "Discri√ß√£o com vizinhos/roommates:", opcoes: ["Precisa ser discreto", "Normal", "Moro s√≥/sem restri√ß√µes"] },
            { texto: "Local para o encontro √≠ntimo:", opcoes: ["Hotel/Airbnb", "Minha casa", "Sua casa"] },
            { texto: "Exclusividade/combina√ß√£o sexual:", opcoes: ["Exclusivo entre n√≥s", "Aberto com regras", "Sem r√≥tulos (conversamos)"] },
            { texto: "Orgasmo: prefere como?", opcoes: ["Juntos se der", "Sem pressa, cada um no seu tempo", "Sem regra"] },
            { texto: "Ritmo de evolu√ß√£o no encontro:", opcoes: ["Come√ßar leve e subir", "R√°pido se houver qu√≠mica", "Vamos sentindo"] },
            { texto: "Contato com saliva em brinquedos/barreiras:", opcoes: ["Ok", "S√≥ com higiene pr√©via", "Prefiro evitar"] },
            { texto: "Higieniza√ß√£o de brinquedos:", opcoes: ["Sei e fa√ßo certinho", "Aprendemos juntos", "Prefiro n√£o usar"] },
            { texto: "Mensagens antes (conte√∫do expl√≠cito):", opcoes: ["Evito conte√∫do expl√≠cito", "Ok com limites", "S√≥ depois de alinhar"] }

    ]
  };
  // =======================

  // Estado
  let indice = 0;
  const respostas = new Array(quizConfig.perguntas.length).fill(null);
  const userInfo = { idade: null, altura: null, peso: null, genero: "", orientacao: "" };

  // Elementos
  const elTitle = document.querySelector('.title');
  const elDesc = document.getElementById('quizDesc');
  const elQuestion = document.getElementById('question');
  const elOptions = document.getElementById('options');
  const elStepLabel = document.getElementById('stepLabel');
  const elProgress = document.getElementById('progress');
  const btnNext = document.getElementById('btnNext');
  const btnBack = document.getElementById('btnBack');
  const screenAgeGate = document.getElementById('screen-agegate');
  const screenIntro = document.getElementById('screen-intro');
  const screenQuiz = document.getElementById('screen-quiz');
  const screenResult = document.getElementById('screen-result');
  const elFinalMessage = document.getElementById('finalMessage');
  const elAnswers = document.getElementById('answers');
  const elUserData = document.getElementById('userData');
  const btnReiniciar = document.getElementById('btnReiniciar');
  const btnWhatsApp = document.getElementById('btnWhatsApp');
  const idadeInput = document.getElementById('idadeInput');
  const alturaInput = document.getElementById('alturaInput');
  const pesoInput = document.getElementById('pesoInput');
  const orientacaoOutro = document.getElementById('orientacaoOutro');
  const btnStart = document.getElementById('btnStart');
  const btnIntroBack = document.getElementById('btnIntroBack');
  const btnAgeContinue = document.getElementById('btnAgeContinue');
  const btnAgeExit = document.getElementById('btnAgeExit');
  const errIdade = document.getElementById('errIdade');
  const errAltura = document.getElementById('errAltura');
  const errPeso = document.getElementById('errPeso');
  const errOrientacao = document.getElementById('errOrientacao');
  const errGenero = document.getElementById('errGenero');
  const generoChipWrap = document.getElementById('generoChips');
  const orientacaoChipWrap = document.getElementById('orientacaoChips');

  // Chips
  let selectedGenero = null;
  function renderGeneroChips(){
    generoChipWrap.innerHTML = '';
    (quizConfig.generos || ["Homem","Mulher"]).forEach((rotulo)=>{
      const chip = document.createElement('button');
      chip.className = 'chip';
      chip.type = 'button';
      chip.setAttribute('role','radio');
      chip.setAttribute('aria-pressed', 'false');
      chip.textContent = rotulo;
      chip.addEventListener('click', ()=>{
        selectedGenero = rotulo;
        [...generoChipWrap.children].forEach(c=>c.setAttribute('aria-pressed','false'));
        chip.setAttribute('aria-pressed','true');
      });
      generoChipWrap.appendChild(chip);
    });
  }

  let selectedOrientacao = null;
  function renderOrientacaoChips(){
    orientacaoChipWrap.innerHTML = '';
    quizConfig.orientacoes.forEach((rotulo)=>{
      const chip = document.createElement('button');
      chip.className = 'chip';
      chip.type = 'button';
      chip.setAttribute('role','radio');
      chip.setAttribute('aria-pressed', 'false');
      chip.textContent = rotulo;
      chip.addEventListener('click', ()=>{
        selectedOrientacao = rotulo;
        [...orientacaoChipWrap.children].forEach(c=>c.setAttribute('aria-pressed','false'));
        chip.setAttribute('aria-pressed','true');
        if(rotulo === 'Outro'){
          orientacaoOutro.style.display = '';
          orientacaoOutro.focus();
        } else {
          orientacaoOutro.style.display = 'none';
          orientacaoOutro.value = '';
        }
      });
      orientacaoChipWrap.appendChild(chip);
    });
  }

  function init(){
    elTitle.textContent = quizConfig.titulo || 'Seu Quiz';
    elDesc.textContent = quizConfig.descricao || '';
    elFinalMessage.textContent = quizConfig.finalMessage || '';
    screenAgeGate.style.display = '';
    screenIntro.style.display = 'none';
    screenQuiz.style.display = 'none';
    screenResult.classList.remove('show');
    elStepLabel.textContent = '+18';
    elProgress.style.width = '0%';
    renderGeneroChips();
    renderOrientacaoChips();
  }

  // Perguntas
  function renderPergunta(){
    const total = quizConfig.perguntas.length;
    const { texto, opcoes } = quizConfig.perguntas[indice];

    elQuestion.textContent = texto;
    elOptions.innerHTML = '';

    opcoes.forEach((label, i) => {
      const btn = document.createElement('button');
      btn.className = 'btn option';
      btn.type = 'button';
      btn.setAttribute('role', 'option');
      btn.setAttribute('aria-selected', respostas[indice] === i ? 'true' : 'false');
      btn.textContent = label;
      if(respostas[indice] === i){ btn.classList.add('selected'); }
      btn.addEventListener('click', () => selecionarOpcao(i, btn));
      elOptions.appendChild(btn);
    });

    elStepLabel.textContent = `Pergunta ${indice+1}/${total}`;
    btnNext.textContent = indice === total-1 ? 'Concluir' : 'Avan√ßar ‚ü∂';
  }

  function selecionarOpcao(opcaoIndex, btn){
    respostas[indice] = opcaoIndex;
    [...elOptions.children].forEach(b =>{ b.classList.remove('selected'); b.setAttribute('aria-selected','false'); });
    btn.classList.add('selected');
    btn.setAttribute('aria-selected','true');
    btnNext.disabled = false;
    updateProgress();
  }

  function avancar(){
    const total = quizConfig.perguntas.length;
    if(indice < total - 1){
      indice++;
      renderPergunta();
      updateBotoes();
      updateProgress();
      btnNext.disabled = respostas[indice] === null;
    } else {
      mostrarResultado();
    }
  }

  function voltar(){
    if(indice > 0){
      indice--;
      renderPergunta();
      updateBotoes();
      updateProgress();
      btnNext.disabled = respostas[indice] === null;
    }
  }

  function updateBotoes(){
    btnBack.disabled = indice === 0;
    btnNext.disabled = respostas[indice] === null;
  }

  function updateProgress(){
    const total = quizConfig.perguntas.length;
    const answered = respostas.filter(v => v !== null).length;
    const pct = Math.round((answered/total) * 100);
    elProgress.style.width = pct + '%';
  }

  function mostrarResultado(){
    screenQuiz.style.display = 'none';
    screenResult.classList.add('show');
    elFinalMessage.textContent = quizConfig.finalMessage || '';
    ensureResultUI();
    renderPercents();

    // Dados iniciais
    elUserData.innerHTML = '';
    const orientacaoFinal = (selectedOrientacao === 'Outro' ? (orientacaoOutro.value || 'Outro') : selectedOrientacao) || '';
    const generoFinal = selectedGenero || '';
    const dados = [
      ['Idade', userInfo.idade],
      ['G√™nero', generoFinal],
      ['Altura', `${userInfo.altura} cm`],
      ['Peso', `${userInfo.peso} kg`],
      ['Orienta√ß√£o', orientacaoFinal]
    ];
    dados.forEach(([k,v]) => {
      const li = document.createElement('li');
      li.innerHTML = `<strong>${k}:</strong> ${v}`;
      elUserData.appendChild(li);
    });

    // Respostas
    elAnswers.innerHTML = '';
    quizConfig.perguntas.forEach((p, idx) => {
      const li = document.createElement('li');
      const escolhida = respostas[idx];
      const textoEscolha = escolhida !== null ? p.opcoes[escolhida] : '(sem resposta)';
      li.innerHTML = `<strong>${idx+1}.</strong> ${p.texto}<br><em>Resposta:</em> ${textoEscolha}`;
      elAnswers.appendChild(li);
    });
  }

  // ===== WhatsApp =====
  function buildWhatsAppText(){
    const linhasTopo = [];
    const orientacaoFinal = (selectedOrientacao === 'Outro' ? (orientacaoOutro.value || 'Outro') : selectedOrientacao) || '';
    const generoFinal = selectedGenero || '';

    // Sauda√ß√£o topo
    const primeira = (quizConfig.firstMessage || "Ol√°!");
    linhasTopo.push(primeira);

    // Tapete de * (50 linhas)
    const separador = Array.from({length: 50}, () => "*").join("\n");
    linhasTopo.push(separador);

    // Bloco final (dados + respostas)
    const linhasFim = [];
    linhasFim.push(`*${quizConfig.titulo || 'Quiz'}*`);
    linhasFim.push('');
    linhasFim.push('*Dados iniciais*');
    linhasFim.push(`Idade: ${userInfo.idade}`);
    linhasFim.push(`G√™nero: ${generoFinal}`);
    linhasFim.push(`Altura: ${userInfo.altura} cm`);
    linhasFim.push(`Peso: ${userInfo.peso} kg`);
    linhasFim.push(`Orienta√ß√£o: ${orientacaoFinal}`);
    linhasFim.push('');
    linhasFim.push('*Respostas*');
    quizConfig.perguntas.forEach((p, i)=>{
      const idx = respostas[i];
      const r = idx !== null ? p.opcoes[idx] : '(sem resposta)';
      linhasFim.push(`${i+1}. ${p.texto}\n- ${r}`);
    });
    linhasFim.push('');
    if (quizConfig.finalMessage) linhasFim.push(quizConfig.finalMessage);

    return [...linhasTopo, ...linhasFim].join('\n');
  }

  function enviarWhatsApp(){
    const texto = buildWhatsAppText();
    const numero = (quizConfig.whatsappNumber || '').replace(/\D/g,'');
    const base = numero
      ? `https://api.whatsapp.com/send?phone=${numero}&text=`
      : 'https://api.whatsapp.com/send?text=';
    const url = base + encodeURIComponent(texto);
    window.open(url, '_blank');
  }
    
  // ===== Resultado estimado (3 percentuais) + revelar/ocultar respostas =====
function calcPercents() {
  // Conta quantas vezes o usu√°rio escolheu a 1¬™, 2¬™ ou 3¬™ op√ß√£o
  const counts = [0, 0, 0];
  respostas.forEach(idx => {
    if (idx === 0) counts[0]++;
    else if (idx === 1) counts[1]++;
    else if (idx === 2) counts[2]++;
  });

  // Gera n√∫meros aleat√≥rios "puxados" para as contagens (quanto mais escolheu, maior tende a ser)
  const bias = counts.map(c => c + 1); // evita zero
  const rand = bias.map(w => Math.random() * (w + 0.5));
  const sum = rand.reduce((a, b) => a + b, 0) || 1;

  let p0 = Math.floor((rand[0] / sum) * 100);
  let p1 = Math.floor((rand[1] / sum) * 100);
  let p2 = 100 - p0 - p1;
  if (p2 < 0) { p2 = 0; p1 = Math.max(0, 100 - p0); }

  return [p0, p1, p2];
}

function ensureResultUI() {
  const screenResult = document.getElementById('screen-result');
  const answersList = document.getElementById('answers');
  const answersHeader = answersList?.previousElementSibling;

  // Bloco dos percentuais (cria s√≥ uma vez)
  if (!document.getElementById('percentBox')) {
    const box = document.createElement('div');
    box.id = 'percentBox';
    box.className = 'answers';
    screenResult.insertBefore(box, answersHeader); // antes do "Suas escolhas"
  }

  // Bot√£o revelar/ocultar (cria s√≥ uma vez)
  if (!document.getElementById('btnToggleAnswers')) {
    const btn = document.createElement('button');
    btn.id = 'btnToggleAnswers';
    btn.type = 'button';
    btn.className = 'btn';
    btn.textContent = 'Revelar respostas';
    btn.addEventListener('click', () => {
      const showing = answersList.style.display !== 'none';
      if (showing) {
        answersList.style.display = 'none';
        if (answersHeader) answersHeader.style.display = 'none';
        btn.textContent = 'Revelar respostas';
      } else {
        answersList.style.display = '';
        if (answersHeader) answersHeader.style.display = '';
        btn.textContent = 'Ocultar respostas';
      }
    });
    screenResult.insertBefore(btn, answersHeader);
  }

  // Esconde respostas por padr√£o
  answersList.style.display = 'none';
  if (answersHeader) answersHeader.style.display = 'none';
  const toggleBtn = document.getElementById('btnToggleAnswers');
  if (toggleBtn) toggleBtn.textContent = 'Revelar respostas';
}

function renderPercents() {
  const labels = (quizConfig.percentLabels?.length === 3)
    ? quizConfig.percentLabels
    : ['Op√ß√£o A', 'Op√ß√£o B', 'Op√ß√£o C'];

  const [a, b, c] = calcPercents();
  const box = document.getElementById('percentBox');

  box.innerHTML = `
    <h3 style="margin:0 0 6px 0">Resultado estimado</h3>
    <ul style="list-style:none; padding:0; display:grid; gap:8px">
      <li class="answers"><strong>${labels[0]}:</strong> ${a}%</li>
      <li class="answers"><strong>${labels[1]}:</strong> ${b}%</li>
      <li class="answers"><strong>${labels[2]}:</strong> ${c}%</li>
    </ul>
  `;
}
  // ===== Planilha (Apps Script Web App) =====
    function buildSheetPayload(){
      const orientacaoFinal = (selectedOrientacao === 'Outro' ? (orientacaoOutro.value || 'Outro') : selectedOrientacao) || '';
      const generoFinal = selectedGenero || '';

      const payload = {
        'Timestamp': new Date().toISOString(),
        'T√≠tulo do Quiz': (quizConfig.titulo || '').toString().trim(),
        'Descri√ß√£o': (quizConfig.descricao || '').toString().trim(),
        'Idade': userInfo.idade ?? '',
        'G√™nero': generoFinal,
        'Altura (cm)': userInfo.altura ?? '',
        'Peso (kg)': userInfo.peso ?? '',
        'Orienta√ß√£o': orientacaoFinal
      };

      // chaves √∫nicas por pergunta
      quizConfig.perguntas.forEach((p, i) => {
        const idx = respostas[i];
        const r = idx !== null ? p.opcoes[idx] : '';
        const key = `Q ${String(i+1).padStart(2,'0')} - ${p.texto}`;
        payload[key] = r;
      });

      return payload;
    }



  async function enviarPlanilha(){
    const url = quizConfig.sheetWebAppURL;
    if(!url){
      console.warn('sheetWebAppURL n√£o configurado.');
      return;
    }
    const body = JSON.stringify(buildSheetPayload());
    try {
      await fetch(url, {
        method: 'POST',
        mode: 'no-cors', // evita bloqueio CORS; resposta fica "opaque"
        headers: { 'Content-Type': 'application/json' },
        body
      });
    } catch (err) {
      console.error('Falha ao enviar para a planilha:', err);
    }
  }

  // Valida√ß√£o
  function validarPreDados(){
    const idade = parseInt(idadeInput.value,10);
    const altura = parseInt(alturaInput.value,10);
    const peso = parseFloat(pesoInput.value);
    const orientacaoVal = selectedOrientacao === 'Outro' ? (orientacaoOutro.value || '').trim() : selectedOrientacao;

    errGenero.style.display = (!selectedGenero) ? 'block' : 'none';
    errIdade.style.display = (!Number.isFinite(idade) || idade < 18) ? 'block' : 'none';
    errAltura.style.display = (!Number.isFinite(altura) || altura <= 0) ? 'block' : 'none';
    errPeso.style.display = (!Number.isFinite(peso) || peso <= 0) ? 'block' : 'none';
    errOrientacao.style.display = (!orientacaoVal || orientacaoVal.length === 0) ? 'block' : 'none';

    if([errGenero,errIdade,errAltura,errPeso,errOrientacao].some(e=>e.style.display==='block')) return null;

    return { idade, altura, peso, genero: selectedGenero, orientacao: orientacaoVal };
  }

  function startQuiz(){
    const dados = validarPreDados();
    if(!dados) return;

    userInfo.idade = dados.idade; userInfo.altura = dados.altura; userInfo.peso = dados.peso; userInfo.genero = dados.genero; userInfo.orientacao = dados.orientacao;

    screenIntro.style.display = 'none';
    screenQuiz.style.display = '';

    indice = 0;
    renderPergunta();
    updateBotoes();
    updateProgress();
    elStepLabel.textContent = `Pergunta ${indice+1}/${quizConfig.perguntas.length}`;
  }

  // A√ß√µes
  btnNext?.addEventListener('click', avancar);
  btnBack?.addEventListener('click', voltar);

  btnReiniciar?.addEventListener('click', ()=>{ location.reload(); });

  // CONCLUIR: envia planilha e abre WhatsApp
  btnWhatsApp?.addEventListener('click', async () => {
    await enviarPlanilha();
    enviarWhatsApp();
  });

  btnStart?.addEventListener('click', startQuiz);
  btnIntroBack?.addEventListener('click', ()=>{
    screenIntro.style.display = 'none';
    screenAgeGate.style.display = '';
    elStepLabel.textContent = '+18';
  });
  btnAgeContinue?.addEventListener('click', ()=>{
    screenAgeGate.style.display = 'none';
    screenIntro.style.display = '';
    elStepLabel.textContent = 'Pr√©-quiz';
  });
  btnAgeExit?.addEventListener('click', ()=>{
    window.location.href = 'about:blank';
  });

  // Acessibilidade b√°sica via teclado (quiz)
  document.addEventListener('keydown', (e)=>{
    if(screenQuiz.style.display==='none') return;
    const focusable = [...elOptions.children];
    const currentIndex = focusable.indexOf(document.activeElement);
    if(["ArrowRight","ArrowDown"].includes(e.key)){
      e.preventDefault();
      const ni = Math.min((currentIndex>=0?currentIndex: -1)+1, focusable.length-1);
      focusable[ni]?.focus();
    }
    if(["ArrowLeft","ArrowUp"].includes(e.key)){
      e.preventDefault();
      const ni = Math.max((currentIndex>=0?currentIndex: focusable.length)+-1, 0);
      focusable[ni]?.focus();
    }
    if(e.key === 'Enter' && document.activeElement?.classList.contains('option')){
      document.activeElement.click();
    }
  });
    
    (function(){
  const INACTIVITY_MS = 7000; // 30s
  let inactivityId = null;
  let btnSkip = null;

  // Garante envio "uma vez s√≥", reaproveitando sua fun√ß√£o existente:
  const _enviarPlanilha = enviarPlanilha;
  let planilhaEnviada = false;
  enviarPlanilha = async function(){
    if (planilhaEnviada) return;
    try { await _enviarPlanilha(); } finally { planilhaEnviada = true; }
  };

  function ensureSkipButton(){
    if (btnSkip) return btnSkip;
    btnSkip = document.createElement('button');
    btnSkip.id = 'btnSkip';
    btnSkip.type = 'button';
    btnSkip.className = 'btn';
    btnSkip.textContent = 'Pular pergunta';
    btnSkip.style.display = 'none';
    btnSkip.addEventListener('click', ()=>{
      // Mant√©m a pergunta como sem resposta (null) e avan√ßa
      hideSkipButton();
      avancar();
    });
    // Insere sem mexer no HTML: usa o mesmo container do bot√£o "Avan√ßar"
    btnNext?.parentElement?.insertBefore(btnSkip, btnNext);
    return btnSkip;
  }
  function showSkipButton(){ ensureSkipButton(); btnSkip.style.display = ''; }
  function hideSkipButton(){ if (btnSkip) btnSkip.style.display = 'none'; }

  function resetInactivityWatch(){
    if (inactivityId) { clearTimeout(inactivityId); inactivityId = null; }
    hideSkipButton();
    if (screenQuiz.style.display !== 'none') {
      inactivityId = setTimeout(()=>{ showSkipButton(); }, INACTIVITY_MS);
    }
  }

  // Patch de hooks sem alterar sua estrutura
  (function hookRenderPergunta(){
    const _renderPergunta = renderPergunta;
    renderPergunta = function(){
      _renderPergunta.apply(this, arguments);
      resetInactivityWatch(); // reinicia o temporizador a cada pergunta exibida
    };
  })();

  // Reseta temporizador ao navegar
  btnNext?.addEventListener('click', resetInactivityWatch);
  btnBack?.addEventListener('click', resetInactivityWatch);

  // Reseta temporizador ao selecionar uma op√ß√£o (qualquer .option dentro de #options)
  elOptions.addEventListener('click', (e)=>{
    if (e.target.closest('.option')) resetInactivityWatch();
  });

  // Ao ir para o resultado, limpa temporizador e envia para a planilha quando clicar em "Revelar respostas" (uma √∫nica vez)
  (function hookMostrarResultado(){
    const _mostrarResultado = mostrarResultado;
    mostrarResultado = function(){
      hideSkipButton();
      if (inactivityId) { clearTimeout(inactivityId); inactivityId = null; }
      _mostrarResultado.apply(this, arguments);

      // Envia ao clicar no bot√£o "Revelar respostas" (apenas na 1¬™ vez)
      const onFirstReveal = (ev)=>{
        if (ev.target && ev.target.id === 'btnToggleAnswers') {
          enviarPlanilha(); // protegido por "uma vez s√≥"
          document.removeEventListener('click', onFirstReveal);
        }
      };
      document.addEventListener('click', onFirstReveal);
    };
  })();
})();
    
 (function(){
  // ===== AJUSTE AQUI =====
  const landingImage = 'home.jpg'; // imagem da tela inicial
  const TOTAL_BG = 240;        // quantidade de imagens da sequ√™ncia
  const DIR      = '.';        // '.' na raiz ou 'img' se estiver em /img
  const EXTS     = ['webp','jpg','jpeg','png']; // ordem de tentativas
  const LANDING_CANDIDATES = ['home.webp','home.jpg','home.jpeg','home.png']; // 1¬™ que existir
  // =======================

  let landing = null;
  let pool = [];
  let last = null;
  let resolvedList = []; // lista final, s√≥ com arquivos que realmente existem
  let ready = false;

  const pad = n => String(n).padStart(3,'0');
  const bases = Array.from({length: TOTAL_BG}, (_,i)=> `${DIR}/bg${pad(i+1)}`);

  function tryLoad(url){
    return new Promise(res=>{
      const im = new Image();
      im.onload  = ()=>res(url);
      im.onerror = ()=>res(null);
      im.src = url;
    });
  }
  async function firstExisting(urls){
    for (const u of urls){
      const ok = await tryLoad(u);
      if (ok) return ok;
    }
    return null;
  }

  async function resolveAll(){
    // 1) Descobre a landing (primeira que existir)
    landing = await firstExisting(LANDING_CANDIDATES.map(f => `${DIR}/${f}`));
    if (!landing) console.warn('Nenhuma landing encontrada entre:', LANDING_CANDIDATES);

    // 2) Resolve TODAS as bgNNN.* que existem (qualquer extens√£o suportada)
    const promises = bases.map(b => firstExisting(EXTS.map(ext => `${b}.${ext}`)));
    const results = await Promise.all(promises);
    resolvedList = results.filter(Boolean);

    if (!resolvedList.length) {
      console.warn('Nenhuma imagem da sequ√™ncia encontrada (.webp/.jpg/.jpeg/.png).');
    }

    // Aplica landing se tiver
    if (landing) setBg(landing);
    refill();
    ready = true;
    console.log(`BGs v√°lidas: ${resolvedList.length}`);
  }

  function setBg(url){
    // seguran√ßa extra: s√≥ aplica se carregar
    tryLoad(url).then(ok=>{
      if (ok) {
        document.documentElement.style.setProperty('--bg-img', `url("${ok}")`);
        console.log('BG OK:', ok);
      } else {
        console.warn('BG ERRO ao aplicar:', url);
      }
    });
  }

  const pick = arr => arr[Math.floor(Math.random()*arr.length)];
  function refill(){
    pool = resolvedList.filter(x => x && x !== landing);
    if (!pool.length && resolvedList.length) pool = resolvedList.slice();
  }
  function nextBg(){
    if (!pool.length) refill();
    if (!pool.length) return null;
    let choice = pick(pool);
    if (last && pool.length > 1 && choice === last){
      const alt = pool.filter(x => x !== last);
      if (alt.length) choice = pick(alt);
    }
    pool = pool.filter(x => x !== choice);
    last = choice;
    return choice;
  }
  function changeAfterTick(){
    if (!ready) return;          // ainda resolvendo as imagens
    const url = nextBg();
    if (url) setBg(url);
  }

  function wire(){
    const btnStart = document.getElementById('btnStart');
    const btnNext  = document.getElementById('btnNext');

    btnStart?.addEventListener('click', changeAfterTick);
    btnNext ?.addEventListener('click', changeAfterTick);

    // "Pular pergunta"
    document.addEventListener('click', (e)=>{
      if (e.target && e.target.id === 'btnSkip') changeAfterTick();
    });
  }

  // Inicia
  wire();
  resolveAll();
})();
  // Start
  init();
  </script>
</body>
</html>
